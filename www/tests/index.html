<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ Webserv Test Suite - Single Page App</title>
    
    <!-- Immediate theme application to prevent flash -->
    <script>
        (function() {
            function getCookie(name) {
                const value = `; ${document.cookie}`;
                const parts = value.split(`; ${name}=`);
                if (parts.length === 2) return parts.pop().split(';').shift();
                return null;
            }
            
            // Apply theme to html element immediately (before body exists)
            const savedTheme = getCookie('theme');
            if (savedTheme && savedTheme !== 'light') {
                document.documentElement.setAttribute('data-theme', savedTheme);
            }
        })();
    </script>
    
    <style>
        /* Theme Variables */
        :root {
            --bg-color: #ffffff;
            --text-color: #333333;
            --accent-color: #007bff;
            --card-bg: #f8f9fa;
            --border-color: #dee2e6;
            --shadow: 0 2px 10px rgba(0,0,0,0.1);
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
        }

        /* Dark theme */
        [data-theme="dark"] {
            --bg-color: #1a1a1a;
            --text-color: #ffffff;
            --accent-color: #4dabf7;
            --card-bg: #2d2d2d;
            --border-color: #404040;
            --shadow: 0 2px 10px rgba(0,0,0,0.5);
        }

        /* Ocean theme */
        [data-theme="ocean"] {
            --bg-color: #0f1419;
            --text-color: #e6e6e6;
            --accent-color: #00d4aa;
            --card-bg: #1e2328;
            --border-color: #2a3441;
            --shadow: 0 2px 10px rgba(0,212,170,0.2);
        }

        /* Sunset theme */
        [data-theme="sunset"] {
            --bg-color: #2d1b69;
            --text-color: #f8f8f2;
            --accent-color: #ff79c6;
            --card-bg: #44475a;
            --border-color: #6272a4;
            --shadow: 0 2px 10px rgba(255,121,198,0.3);
        }

        /* Forest theme */
        [data-theme="forest"] {
            --bg-color: #1b2b1b;
            --text-color: #e8f5e8;
            --accent-color: #7cb342;
            --card-bg: #2e3c2e;
            --border-color: #4a5c4a;
            --shadow: 0 2px 10px rgba(124,179,66,0.2);
        }

        /* Cyberpunk theme */
        [data-theme="cyberpunk"] {
            --bg-color: #0a0a0a;
            --text-color: #00ff41;
            --accent-color: #ff073a;
            --card-bg: #1a1a1a;
            --border-color: #333333;
            --shadow: 0 2px 10px rgba(255,7,58,0.4);
        }

        /* Lavender theme */
        [data-theme="lavender"] {
            --bg-color: #f5f3ff;
            --text-color: #4c1d95;
            --accent-color: #8b5cf6;
            --card-bg: #ede9fe;
            --border-color: #c4b5fd;
            --shadow: 0 2px 10px rgba(139,92,246,0.15);
        }

        /* High contrast theme */
        [data-theme="contrast"] {
            --bg-color: #000000;
            --text-color: #ffffff;
            --accent-color: #ffff00;
            --card-bg: #1a1a1a;
            --border-color: #ffffff;
            --shadow: 0 2px 10px rgba(255,255,255,0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: all 0.3s ease;
            min-height: 100vh;
        }

        /* Navigation */
        .navbar {
            background: var(--card-bg);
            border-bottom: 2px solid var(--border-color);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-brand {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent-color);
        }

        .nav-tabs {
            display: flex;
            gap: 1rem;
        }

        .nav-tab {
            padding: 0.5rem 1rem;
            background: transparent;
            border: 2px solid var(--border-color);
            color: var(--text-color);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9rem;
            text-decoration: none;
        }

        .nav-tab:hover {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        .nav-tab.active {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        .theme-controls {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .theme-btn {
            width: 40px;
            height: 40px;
            border: 2px solid var(--border-color);
            background: var(--card-bg);
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.2s ease;
        }

        .theme-btn:hover {
            transform: scale(1.1);
            border-color: var(--accent-color);
        }

        /* Main Content */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .page {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
        }

        .card h2 {
            color: var(--accent-color);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .grid {
            display: grid;
            gap: 1rem;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }

        .grid-item {
            background: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .grid-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
            border-color: var(--accent-color);
        }

        .btn {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s ease;
            margin: 0.25rem;
        }

        .btn:hover {
            opacity: 0.8;
            transform: translateY(-1px);
        }

        .btn-success { background: var(--success); }
        .btn-warning { background: var(--warning); color: var(--text-color); }
        .btn-danger { background: var(--danger); }

        /* Status indicators */
        .status {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status-success {
            background: rgba(40, 167, 69, 0.1);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .status-error {
            background: rgba(220, 53, 69, 0.1);
            color: var(--danger);
            border: 1px solid var(--danger);
        }

        .status-info {
            background: rgba(0, 123, 255, 0.1);
            color: var(--accent-color);
            border: 1px solid var(--accent-color);
        }

        /* Log area */
        .log-area {
            background: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 1rem;
            max-height: 60vh;
            min-height: 150px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            line-height: 1.4;
            resize: vertical;
        }

        .log-entry {
            margin-bottom: 0.5rem;
            padding: 0.25rem 0;
        }

        .log-info { color: var(--accent-color); }
        .log-success { color: var(--success); }
        .log-error { color: var(--danger); }
        .log-warning { color: var(--warning); }

        /* Response display */
        .response-display {
            background: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            min-height: 120px;
            max-height: 70vh;
            overflow-y: auto;
            resize: vertical;
        }

        .response-iframe {
            width: 100%;
            height: 60vh;
            max-height: 800px;
            min-height: 300px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: white;
            resize: vertical;
        }

        /* Theme preview */
        .theme-preview {
            display: flex;
            gap: 5px;
            justify-content: center;
            margin-top: 0.5rem;
        }

        .color-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 1px solid var(--border-color);
        }

        /* Input styling */
        input, textarea, select {
            background: var(--bg-color);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            padding: 0.5rem;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
        }

        /* Stats display */
        .stats {
            display: flex;
            justify-content: space-around;
            margin: 1rem 0;
        }

        .stat {
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--accent-color);
        }

        .stat-label {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        /* Mobile responsive */
        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                gap: 1rem;
                padding: 1rem;
            }

            .nav-tabs {
                flex-wrap: wrap;
                justify-content: center;
            }

            .container {
                padding: 1rem;
            }

            .grid {
                grid-template-columns: 1fr;
            }

            .stats {
                flex-direction: column;
                gap: 1rem;
            }

            /* Mobile responsive log areas */
            .log-area {
                max-height: 50vh;
                min-height: 120px;
                font-size: 0.8rem;
            }

            .response-display {
                max-height: 60vh;
                min-height: 100px;
            }

            .response-iframe {
                height: 50vh;
                min-height: 250px;
                max-height: 600px;
            }

            /* Better text wrapping on mobile */
            .log-area pre {
                white-space: pre-wrap;
                word-wrap: break-word;
                overflow-wrap: break-word;
            }
        }

        /* Improved content scaling */
        .log-area pre, .response-display pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-wrap: break-word;
            margin: 0;
        }

        /* Auto-expanding content areas */
        .auto-expand {
            height: auto !important;
            max-height: none !important;
            resize: none;
        }

        /* Smooth scrolling for all scrollable areas */
        .log-area, .response-display {
            scroll-behavior: smooth;
        }

        /* Custom scrollbar styling */
        .log-area::-webkit-scrollbar, .response-display::-webkit-scrollbar {
            width: 8px;
        }

        .log-area::-webkit-scrollbar-track, .response-display::-webkit-scrollbar-track {
            background: var(--card-bg);
            border-radius: 4px;
        }

        .log-area::-webkit-scrollbar-thumb, .response-display::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        .log-area::-webkit-scrollbar-thumb:hover, .response-display::-webkit-scrollbar-thumb:hover {
            background: var(--accent-color);
        }

        /* Scroll indicator for overflowing content */
        .log-area.has-overflow::after {
            content: "‚¨áÔ∏è Scroll";
            position: absolute;
            bottom: 8px;
            right: 12px;
            font-size: 0.7rem;
            background: var(--accent-color);
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            opacity: 0.8;
            pointer-events: none;
            animation: fadeInOut 2s infinite;
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.8; }
        }

        .log-area {
            position: relative;
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-brand">üöÄ Webserv Test Suite</div>
        
        <div class="nav-tabs">
            <a href="#webtests" class="nav-tab active" onclick="showPage('webtests')">üåê Web Tests</a>
            <a href="#themes" class="nav-tab" onclick="showPage('themes')">üé® Themes</a>
            <a href="#sessions" class="nav-tab" onclick="showPage('sessions')">üì¶ Sessions</a>
            <a href="#cgi" class="nav-tab" onclick="showPage('cgi')">‚öôÔ∏è CGI Tests</a>
            <a href="#cookies" class="nav-tab" onclick="showPage('cookies')">üç™ Cookies</a>
            <a href="#debug" class="nav-tab" onclick="showPage('debug')">üîß Debug</a>
        </div>

        <div class="theme-controls">
            <button class="theme-btn" onclick="cycleTheme()" title="Cycle Themes" id="theme-cycle">üé®</button>
            <button class="theme-btn" onclick="randomTheme()" title="Random Theme">üé≤</button>
        </div>
    </nav>

    <div class="container">
        <!-- Web Tests Page -->
        <div id="webtests" class="page active">
            <div class="card">
                <h2>üåê HTTP Method Tests</h2>
                <p>Comprehensive testing of HTTP methods: GET, POST, DELETE with advanced options.</p>
                
                <div class="grid">
                    <div class="grid-item">
                        <h4>üîç GET Test</h4>
                        <input type="text" id="getUrl" placeholder="URL to test" value="/tests/index.html" style="width: 100%; margin-bottom: 0.5rem;">
                        <div style="margin-bottom: 0.5rem;">
                            <label><input type="checkbox" id="getHeaders"> Show headers</label>
                            <label style="margin-left: 1rem;"><input type="checkbox" id="getTime" checked> Measure time</label>
                        </div>
                        <button class="btn" onclick="testGet()">Execute GET</button>
                    </div>
                    
                    <div class="grid-item">
                        <h4>üì§ POST Test</h4>
                        <input type="text" id="postUrl" placeholder="Destination URL" value="/tests/post_result.txt" style="width: 100%; margin-bottom: 0.5rem;">
                        <textarea id="postContent" placeholder="Content to send" style="width: 100%; margin-bottom: 0.5rem; height: 60px;">Test POST with timestamp: ${new Date().toISOString()}</textarea>
                        <select id="postContentType" style="width: 100%; margin-bottom: 0.5rem;">
                            <option value="text/plain">text/plain</option>
                            <option value="application/json">application/json</option>
                            <option value="application/x-www-form-urlencoded">form-urlencoded</option>
                        </select>
                        <button class="btn btn-success" onclick="testPost()">Execute POST</button>
                    </div>
                    
                    <div class="grid-item">
                        <h4>üóëÔ∏è DELETE Test</h4>
                        <input type="text" id="deleteUrl" placeholder="File to delete" value="/tests/post_result.txt" style="width: 100%; margin-bottom: 0.5rem;">
                        <div style="margin-bottom: 0.5rem;">
                            <label><input type="checkbox" id="deleteConfirm"> I confirm deletion</label>
                        </div>
                        <button class="btn btn-danger" onclick="testDelete()">Execute DELETE</button>
                    </div>
                    
                    <div class="grid-item">
                        <h4>üìÅ File Upload</h4>
                        <input type="file" id="uploadFile" style="width: 100%; margin-bottom: 0.5rem;">
                        <input type="text" id="uploadDestination" placeholder="Upload destination" value="/tests/uploads/" style="width: 100%; margin-bottom: 0.5rem;">
                        <button class="btn btn-warning" onclick="testUpload()">Upload File</button>
                    </div>
                </div>

                <div class="response-display">
                    <h4>Test Results:</h4>
                    <div id="webTestResult" class="log-area">
                        Execute any test above to see results...
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>üöÄ Performance Testing</h2>
                <p>Load testing with multiple concurrent requests.</p>
                
                <div class="grid">
                    <div class="grid-item">
                        <h4>Request Count</h4>
                        <input type="number" id="perfRequests" value="50" min="1" max="1000" style="width: 100%;">
                    </div>
                    
                    <div class="grid-item">
                        <h4>Concurrency</h4>
                        <input type="number" id="perfConcurrency" value="10" min="1" max="50" style="width: 100%;">
                    </div>
                    
                    <div class="grid-item">
                        <h4>Target URL</h4>
                        <input type="text" id="perfUrl" value="/tests/index.html" style="width: 100%;">
                    </div>
                    
                    <div class="grid-item">
                        <h4>Execute</h4>
                        <button class="btn btn-success" onclick="testPerformance()">üöÄ Start Load Test</button>
                    </div>
                </div>

                <div class="response-display">
                    <h4>Performance Results:</h4>
                    <div id="performanceResult" class="log-area">
                        Configure parameters and start the test...
                    </div>
                </div>
            </div>
        </div>

        <!-- Theme Management Page -->
        <div id="themes" class="page">
            <div class="card">
                <h2>üé® Theme Selection</h2>
                <p>Choose from 8 different color themes. Your preference is automatically saved.</p>
                
                <div class="grid">
                    <div class="grid-item" onclick="setTheme('light')">
                        <h4>‚òÄÔ∏è Light</h4>
                        <p>Classic clean theme</p>
                        <div class="theme-preview">
                            <div class="color-dot" style="background: #ffffff; border-color: #ccc;"></div>
                            <div class="color-dot" style="background: #333333;"></div>
                            <div class="color-dot" style="background: #007bff;"></div>
                        </div>
                    </div>
                    
                    <div class="grid-item" onclick="setTheme('dark')">
                        <h4>üåô Dark</h4>
                        <p>Easy on the eyes</p>
                        <div class="theme-preview">
                            <div class="color-dot" style="background: #1a1a1a;"></div>
                            <div class="color-dot" style="background: #ffffff;"></div>
                            <div class="color-dot" style="background: #4dabf7;"></div>
                        </div>
                    </div>
                    
                    <div class="grid-item" onclick="setTheme('ocean')">
                        <h4>üåä Ocean</h4>
                        <p>Deep blue vibes</p>
                        <div class="theme-preview">
                            <div class="color-dot" style="background: #0f1419;"></div>
                            <div class="color-dot" style="background: #e6e6e6;"></div>
                            <div class="color-dot" style="background: #00d4aa;"></div>
                        </div>
                    </div>
                    
                    <div class="grid-item" onclick="setTheme('sunset')">
                        <h4>üåÖ Sunset</h4>
                        <p>Purple and pink</p>
                        <div class="theme-preview">
                            <div class="color-dot" style="background: #2d1b69;"></div>
                            <div class="color-dot" style="background: #f8f8f2;"></div>
                            <div class="color-dot" style="background: #ff79c6;"></div>
                        </div>
                    </div>

                    <div class="grid-item" onclick="setTheme('forest')">
                        <h4>üå≤ Forest</h4>
                        <p>Nature greens</p>
                        <div class="theme-preview">
                            <div class="color-dot" style="background: #1b2b1b;"></div>
                            <div class="color-dot" style="background: #e8f5e8;"></div>
                            <div class="color-dot" style="background: #7cb342;"></div>
                        </div>
                    </div>

                    <div class="grid-item" onclick="setTheme('cyberpunk')">
                        <h4>ü§ñ Cyberpunk</h4>
                        <p>Neon matrix style</p>
                        <div class="theme-preview">
                            <div class="color-dot" style="background: #0a0a0a;"></div>
                            <div class="color-dot" style="background: #00ff41;"></div>
                            <div class="color-dot" style="background: #ff073a;"></div>
                        </div>
                    </div>

                    <div class="grid-item" onclick="setTheme('lavender')">
                        <h4>üíú Lavender</h4>
                        <p>Soft purple theme</p>
                        <div class="theme-preview">
                            <div class="color-dot" style="background: #f5f3ff;"></div>
                            <div class="color-dot" style="background: #4c1d95;"></div>
                            <div class="color-dot" style="background: #8b5cf6;"></div>
                        </div>
                    </div>

                    <div class="grid-item" onclick="setTheme('contrast')">
                        <h4>‚ö´ High Contrast</h4>
                        <p>Accessibility focused</p>
                        <div class="theme-preview">
                            <div class="color-dot" style="background: #000000;"></div>
                            <div class="color-dot" style="background: #ffffff;"></div>
                            <div class="color-dot" style="background: #ffff00;"></div>
                        </div>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 2rem;">
                    <button class="btn" onclick="showCurrentColors()">Show Current Colors</button>
                    <button class="btn btn-warning" onclick="autoSwitchThemes()">Auto Switch</button>
                    <button class="btn btn-danger" onclick="resetTheme()">Reset to Light</button>
                </div>
            </div>

            <div class="card">
                <h2>üìä Theme Statistics</h2>
                <div class="stats">
                    <div class="stat">
                        <div class="stat-number" id="theme-changes">0</div>
                        <div class="stat-label">Theme Changes</div>
                    </div>
                    <div class="stat">
                        <div class="stat-number" id="current-theme">Light</div>
                        <div class="stat-label">Current Theme</div>
                    </div>
                    <div class="stat">
                        <div class="stat-number" id="session-time">0s</div>
                        <div class="stat-label">Session Time</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Session Management Page -->
        <div id="sessions" class="page">
            <!-- Session Status Card -->
            <div class="card">
                <h2>üîç Session Status</h2>
                <p>View current session information and manage session lifecycle.</p>
                
                <div id="session-status-indicator" class="status status-info" style="margin-bottom: 1rem;">
                    No Session Active
                </div>
                
                <div class="session-data" id="session-info" style="display: none; background: var(--card-bg); border: 2px solid var(--border-color); border-left: 4px solid var(--accent-color); padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    <h3 style="color: var(--accent-color); margin-bottom: 15px; font-size: 1.1em;">Session Information</h3>
                    <div id="session-details"></div>
                </div>
                
                <button class="btn" onclick="checkStatus()">Refresh Status</button>
            </div>

            <!-- Session Control Card -->
            <div class="card">
                <h2>üéõÔ∏è Session Control</h2>
                <p>Create and destroy sessions with proper cookie management.</p>
                
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-success" onclick="createSession()">Create New Session</button>
                    <button class="btn btn-danger" onclick="destroySession()">Destroy Session</button>
                </div>
                
                <div class="response-display">
                    <h4>Control Output:</h4>
                    <pre id="control-output">Click a button above to manage sessions...</pre>
                </div>
            </div>

            <!-- Data Management Card -->
            <div class="card">
                <h2>üíæ Data Management</h2>
                <p>Store and retrieve key-value data in your session.</p>
                
                <div style="margin-bottom: 15px;">
                    <label for="data-key" style="display: block; margin-bottom: 5px; color: #555; font-weight: 500;">Key:</label>
                    <input type="text" id="data-key" placeholder="e.g., username, theme, preferences" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; margin-bottom: 10px;">
                </div>
                
                <div style="margin-bottom: 15px;">
                    <label for="data-value" style="display: block; margin-bottom: 5px; color: #555; font-weight: 500;">Value:</label>
                    <input type="text" id="data-value" placeholder="e.g., john_doe, dark, saved" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; margin-bottom: 10px;">
                </div>
                
                <div style="margin-bottom: 15px;">
                    <button class="btn" onclick="setData()">Set Data</button>
                    <button class="btn btn-warning" onclick="getData()">Get Data</button>
                    <button class="btn" onclick="getAllData()">Get All</button>
                </div>
                
                <div class="response-display">
                    <h4>Data Output:</h4>
                    <pre id="data-output">Use the form above to store and retrieve session data...</pre>
                </div>
            </div>

            <!-- Session Browser Card -->
            <div class="card">
                <h2>üóÇÔ∏è Session Browser</h2>
                <p>View all active sessions on the server (for debugging purposes).</p>
                
                <button class="btn" onclick="listAllSessions()">List All Sessions</button>
                
                <div style="max-height: 250px; overflow-y: auto; margin-top: 15px;" id="session-list">
                    Click "List All Sessions" to see active sessions...
                </div>
            </div>
        </div>

        <!-- CGI Testing Page -->
        <div id="cgi" class="page">
            <div class="card">
                <h2>‚öôÔ∏è CGI Testing</h2>
                <p>Select and execute various CGI scripts with different formats and capabilities.</p>
                
                <div class="grid" style="grid-template-columns: 1fr 2fr;">
                    <div class="grid-item">
                        <h4>üéØ CGI Script Selector</h4>
                        <div style="margin-bottom: 1rem;">
                            <label for="cgi-selector" style="display: block; margin-bottom: 0.5rem; font-weight: bold;">Choose a CGI script:</label>
                            <select id="cgi-selector" style="width: 100%; padding: 0.5rem; border: 1px solid var(--border-color); border-radius: 4px; background: var(--card-bg); color: var(--text-color);">
                                <option value="/tests/simple.cgi.py">Simple Python CGI - Basic info</option>
                                <option value="/tests/hello.cgi.sh">Shell Script CGI - System info</option>
                                <option value="/tests/json_info.cgi.py">JSON Python CGI - API format</option>
                                <option value="/tests/form_processor.cgi.py">Form Processor CGI - Interactive form</option>
                                <option value="/tests/cgi_env.py">Environment CGI - Full env vars</option>
                                <option value="/tests/debug_cgi.py">Debug CGI - Debugging info</option>
                                <option value="/tests/perl_demo.cgi.pl">Perl CGI - Classic Perl scripting</option>
                                <option value="/tests/ruby_gem.cgi.rb">Ruby CGI - Elegant Ruby processing</option>
                                <option value="/tests/c_power.cgi">C CGI - Compiled binary performance</option>
                                <option value="/tests/node_rocket.cgi.js">Node.js CGI - JavaScript V8 engine</option>
                                <option value="/tests/awk_power.cgi.awk">AWK CGI - Text processing patterns</option>
                            </select>
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <label for="cgi-method" style="display: block; margin-bottom: 0.5rem; font-weight: bold;">HTTP Method:</label>
                            <select id="cgi-method" style="width: 100%; padding: 0.5rem; border: 1px solid var(--border-color); border-radius: 4px; background: var(--card-bg); color: var(--text-color);">
                                <option value="GET">GET</option>
                                <option value="POST">POST</option>
                            </select>
                        </div>
                        
                        <div id="post-data-section" style="margin-bottom: 1rem; display: none;">
                            <label for="cgi-post-data" style="display: block; margin-bottom: 0.5rem; font-weight: bold;">POST Data:</label>
                            <textarea id="cgi-post-data" placeholder="key1=value1&key2=value2" rows="3" style="width: 100%; padding: 0.5rem; border: 1px solid var(--border-color); border-radius: 4px; background: var(--card-bg); color: var(--text-color); resize: vertical;"></textarea>
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <label for="cgi-query" style="display: block; margin-bottom: 0.5rem; font-weight: bold;">Query Parameters:</label>
                            <input type="text" id="cgi-query" placeholder="param1=value1&param2=value2" style="width: 100%; padding: 0.5rem; border: 1px solid var(--border-color); border-radius: 4px; background: var(--card-bg); color: var(--text-color);">
                        </div>
                        
                        <button class="btn" onclick="executeCGI()" style="width: 100%; padding: 1rem; font-size: 1.1rem;">
                            üöÄ Execute CGI Script
                        </button>
                        
                        <div style="margin-top: 1rem;">
                            <span class="status status-info" id="cgi-status">Ready to execute</span>
                        </div>
                    </div>
                    
                    <div class="grid-item">
                        <h4>üìÑ CGI Response Output</h4>
                        <div style="margin-bottom: 1rem;">
                            <button class="btn" onclick="clearCGIOutput()" style="margin-right: 0.5rem;">Clear</button>
                            <button class="btn" onclick="openCGIInNewTab()" style="margin-right: 0.5rem;">Open in New Tab</button>
                            <button class="btn" onclick="downloadCGIResponse()">Download Response</button>
                        </div>
                        <iframe id="cgi-iframe" class="response-iframe" src="about:blank"></iframe>
                    </div>
                </div>

                <div class="grid" style="margin-top: 2rem;">
                    <div class="grid-item">
                        <h4>üîß Quick Actions</h4>
                        <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                            <button class="btn btn-success" onclick="testFormSubmission()">Test Form</button>
                            <button class="btn btn-warning" onclick="testErrorHandling()">Test 404</button>
                            <button class="btn btn-danger" onclick="testTimeout()">Test Timeout</button>
                        </div>
                    </div>
                    
                    <div class="grid-item">
                        <h4>üìã Script Descriptions</h4>
                        <div id="cgi-description" style="font-size: 0.9rem; color: var(--text-color); opacity: 0.8;">
                            Select a CGI script to see its description and capabilities.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Cookie Management Page -->
        <div id="cookies" class="page">
            <div class="card">
                <h2>üç™ Cookie Management</h2>
                <p>View and manage browser cookies for testing.</p>
                
                <div class="grid">
                    <div class="grid-item">
                        <h4>Current Cookies</h4>
                        <div id="cookie-count" class="status status-info">0 cookies</div>
                        <button class="btn" onclick="refreshCookies()">Refresh</button>
                    </div>
                    
                    <div class="grid-item">
                        <h4>Set Custom Cookie</h4>
                        <input type="text" id="cookie-name" placeholder="Cookie name" style="width: 100%; margin-bottom: 0.5rem;">
                        <input type="text" id="cookie-value" placeholder="Cookie value" style="width: 100%; margin-bottom: 0.5rem;">
                        <button class="btn btn-success" onclick="setCustomCookie()">Set Cookie</button>
                    </div>
                    
                    <div class="grid-item">
                        <h4>Test Cookies</h4>
                        <p>Create test cookies</p>
                        <button class="btn" onclick="createTestCookies()">Create Test Cookies</button>
                    </div>
                    
                    <div class="grid-item">
                        <h4>Clear All</h4>
                        <p>Remove all cookies</p>
                        <button class="btn btn-danger" onclick="clearAllCookies()">Clear All</button>
                    </div>
                </div>

                <div class="response-display">
                    <h4>Cookie Details:</h4>
                    <div id="cookie-display" class="log-area">
                        Loading cookies...
                    </div>
                </div>
            </div>
        </div>

        <!-- Debug Page -->
        <div id="debug" class="page">
            <div class="card">
                <h2>üîß Debug Information</h2>
                <p>System information and debug tools.</p>
                
                <div class="grid">
                    <div class="grid-item">
                        <h4>System Info</h4>
                        <button class="btn" onclick="showSystemInfo()">Show Info</button>
                    </div>
                    
                    <div class="grid-item">
                        <h4>Network Test</h4>
                        <button class="btn" onclick="testNetwork()">Test Network</button>
                    </div>
                    
                    <div class="grid-item">
                        <h4>Console Log</h4>
                        <button class="btn btn-warning" onclick="exportLogs()">Export Logs</button>
                    </div>
                    
                    <div class="grid-item">
                        <h4>Reset All</h4>
                        <button class="btn btn-danger" onclick="resetAll()">Reset Everything</button>
                    </div>
                </div>

                <div class="response-display">
                    <h4>Debug Output:</h4>
                    <div id="debug-output" class="log-area">
                        Debug information will appear here...
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>üìù Activity Log</h2>
                <div class="log-area" id="activity-log">
                    <div class="log-entry log-info">[Init] SPA Demo initialized</div>
                </div>
                <div style="text-align: center; margin-top: 1rem;">
                    <button class="btn" onclick="clearLogs()">Clear Logs</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let currentTheme = 'light';
        let themeChanges = 0;
        let sessionStartTime = Date.now();
        let autoSwitchInterval = null;
        let activityLog = [];

        const themes = ['light', 'dark', 'ocean', 'sunset', 'forest', 'cyberpunk', 'lavender', 'contrast'];
        
        const themeIcons = {
            light: '‚òÄÔ∏è', dark: 'üåô', ocean: 'üåä', sunset: 'üåÖ', 
            forest: 'üå≤', cyberpunk: 'ü§ñ', lavender: 'üíú', contrast: '‚ö´'
        };

        // Utility functions
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            activityLog.push({ message: logEntry, type });
            
            const logArea = document.getElementById('activity-log');
            if (logArea) {
                const logDiv = document.createElement('div');
                logDiv.className = `log-entry log-${type}`;
                logDiv.textContent = logEntry;
                logArea.appendChild(logDiv);
                logArea.scrollTop = logArea.scrollHeight;
                
                // Check for overflow after adding content
                setTimeout(() => checkForOverflow(logArea), 100);
            }
            
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        function setCookie(name, value, days = 30) {
            const expires = new Date();
            expires.setTime(expires.getTime() + (days * 24 * 60 * 60 * 1000));
            document.cookie = `${name}=${value};expires=${expires.toUTCString()};path=/`;
        }

        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
            return null;
        }

        function getAllCookies() {
            const cookies = {};
            if (document.cookie) {
                document.cookie.split(';').forEach(cookie => {
                    const [name, value] = cookie.trim().split('=');
                    if (name && value) {
                        cookies[name] = value;
                    }
                });
            }
            return cookies;
        }

        // URL hash routing
        function updateHash(pageId) {
            window.location.hash = pageId;
        }

        function getHashPage() {
            const hash = window.location.hash.slice(1);
            return hash || 'webtests';
        }

        // Statistics tracking
        const stats = {
            totalRequests: 0,
            totalResponseTime: 0,
            successCount: 0,
            dataTransferred: 0
        };

        function updateStats(responseTime = 0, success = true, dataSize = 0) {
            stats.totalRequests++;
            stats.totalResponseTime += responseTime;
            if (success) stats.successCount++;
            stats.dataTransferred += dataSize;
            
            document.getElementById('totalRequests').textContent = stats.totalRequests;
            document.getElementById('avgResponseTime').textContent = 
                stats.totalRequests > 0 ? Math.round(stats.totalResponseTime / stats.totalRequests) + 'ms' : '0ms';
            document.getElementById('successRate').textContent = 
                stats.totalRequests > 0 ? Math.round((stats.successCount / stats.totalRequests) * 100) + '%' : '100%';
            document.getElementById('dataTransferred').textContent = formatBytes(stats.dataTransferred);
        }

        function formatBytes(bytes) {
            if (bytes === 0) return '0B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + sizes[i];
        }

        // Responsive content area functions
        function toggleResponseBoxSize(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.classList.toggle('auto-expand');
                
                // Update button text if it exists
                const toggleBtn = document.querySelector(`[onclick*="${elementId}"]`);
                if (toggleBtn) {
                    const isExpanded = element.classList.contains('auto-expand');
                    toggleBtn.textContent = isExpanded ? 'üìè Fixed Size' : 'üìê Auto Size';
                }
                
                // Check for overflow after toggle
                setTimeout(() => checkForOverflow(element), 100);
                
                log(`Toggled ${elementId} size mode: ${element.classList.contains('auto-expand') ? 'auto-expand' : 'fixed'}`, 'info');
            }
        }

        function checkForOverflow(element) {
            if (element && element.classList.contains('log-area')) {
                if (element.scrollHeight > element.clientHeight) {
                    element.classList.add('has-overflow');
                } else {
                    element.classList.remove('has-overflow');
                }
            }
        }

        function addResizeToggleButton(containerId, targetId) {
            const container = document.getElementById(containerId);
            if (container && !container.querySelector('.resize-toggle')) {
                const button = document.createElement('button');
                button.className = 'btn resize-toggle';
                button.style.marginLeft = '0.5rem';
                button.textContent = 'üìê Auto Size';
                button.onclick = () => toggleResponseBoxSize(targetId);
                
                const header = container.querySelector('h4');
                if (header) {
                    header.appendChild(button);
                }
            }
        }

        function displayWebTestResult(content, isSuccess = true) {
            const element = document.getElementById('webTestResult');
            element.innerHTML = `<div class="log-entry ${isSuccess ? 'log-success' : 'log-error'}">${content}</div>`;
            element.scrollTop = element.scrollHeight;
            setTimeout(() => checkForOverflow(element), 100);
        }

        function displayPerformanceResult(content) {
            const element = document.getElementById('performanceResult');
            element.innerHTML = `<div class="log-entry log-info">${content}</div>`;
            element.scrollTop = element.scrollHeight;
            setTimeout(() => checkForOverflow(element), 100);
        }

        // Web testing functions
        async function testGet() {
            const url = document.getElementById('getUrl').value;
            const showHeaders = document.getElementById('getHeaders').checked;
            const measureTime = document.getElementById('getTime').checked;
            
            displayWebTestResult('üîÑ Executing GET request...', true);
            
            const startTime = measureTime ? performance.now() : 0;
            
            try {
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'
                    }
                });
                
                const endTime = measureTime ? performance.now() : 0;
                const responseTime = endTime - startTime;
                const text = await response.text();
                const dataSize = text.length;
                
                let result = `‚úÖ GET ${url}\n`;
                result += `Status: ${response.status} ${response.statusText}\n`;
                
                if (measureTime) {
                    result += `Response time: ${Math.round(responseTime)}ms\n`;
                }
                
                if (showHeaders) {
                    result += `\nüìã Headers:\n`;
                    for (const [key, value] of response.headers.entries()) {
                        result += `${key}: ${value}\n`;
                    }
                }
                
                result += `\nüìÑ Response (${dataSize} bytes):\n`;
                result += text.length > 500 ? text.substring(0, 500) + '...' : text;
                
                displayWebTestResult(result, true);
                updateStats(responseTime, response.ok, dataSize);
                
            } catch (error) {
                displayWebTestResult(`‚ùå GET Error: ${error.message}`, false);
                updateStats(0, false);
            }
        }

        async function testPost() {
            const url = document.getElementById('postUrl').value;
            const content = document.getElementById('postContent').value;
            const contentType = document.getElementById('postContentType').value;
            
            displayWebTestResult('üì§ Executing POST request...', true);
            
            const startTime = performance.now();
            
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': contentType
                    },
                    body: content
                });
                
                const endTime = performance.now();
                const responseTime = endTime - startTime;
                const responseText = await response.text();
                const dataSize = responseText.length;
                
                let result = `‚úÖ POST ${url}\n`;
                result += `Status: ${response.status} ${response.statusText}\n`;
                result += `Response time: ${Math.round(responseTime)}ms\n`;
                result += `Content-Type: ${contentType}\n`;
                result += `\nüì§ Sent data (${content.length} bytes):\n${content}\n`;
                result += `\nüìÑ Server response:\n${responseText}`;
                
                displayWebTestResult(result, response.ok);
                updateStats(responseTime, response.ok, dataSize);
                
            } catch (error) {
                displayWebTestResult(`‚ùå POST Error: ${error.message}`, false);
                updateStats(0, false);
            }
        }

        async function testDelete() {
            const url = document.getElementById('deleteUrl').value;
            const confirm = document.getElementById('deleteConfirm').checked;
            
            if (!confirm) {
                displayWebTestResult('‚ö†Ô∏è Please confirm deletion by checking the box', false);
                return;
            }
            
            displayWebTestResult('üóëÔ∏è Executing DELETE request...', true);
            
            const startTime = performance.now();
            
            try {
                const response = await fetch(url, {
                    method: 'DELETE'
                });
                
                const endTime = performance.now();
                const responseTime = endTime - startTime;
                const responseText = await response.text();
                const dataSize = responseText.length;
                
                let result = `‚úÖ DELETE ${url}\n`;
                result += `Status: ${response.status} ${response.statusText}\n`;
                result += `Response time: ${Math.round(responseTime)}ms\n`;
                result += `\nüìÑ Server response:\n${responseText}`;
                
                displayWebTestResult(result, response.ok);
                updateStats(responseTime, response.ok, dataSize);
                
                // Uncheck confirmation after use
                document.getElementById('deleteConfirm').checked = false;
                
            } catch (error) {
                displayWebTestResult(`‚ùå DELETE Error: ${error.message}`, false);
                updateStats(0, false);
            }
        }

        async function testUpload() {
            const fileInput = document.getElementById('uploadFile');
            const destination = document.getElementById('uploadDestination').value;
            
            if (!fileInput.files.length) {
                displayWebTestResult('‚ö†Ô∏è Please select at least one file', false);
                return;
            }
            
            displayWebTestResult('üìÅ Uploading file...', true);
            
            const file = fileInput.files[0];
            const formData = new FormData();
            formData.append('file', file);
            
            const startTime = performance.now();
            
            try {
                const response = await fetch(destination, {
                    method: 'POST',
                    body: formData
                });
                
                const endTime = performance.now();
                const responseTime = endTime - startTime;
                const responseText = await response.text();
                
                let result = `‚úÖ Upload to ${destination}\n`;
                result += `Status: ${response.status} ${response.statusText}\n`;
                result += `Response time: ${Math.round(responseTime)}ms\n`;
                result += `File: ${file.name} (${formatBytes(file.size)})\n`;
                result += `\nüìÑ Server response:\n${responseText}`;
                
                displayWebTestResult(result, response.ok);
                updateStats(responseTime, response.ok, file.size);
                
            } catch (error) {
                displayWebTestResult(`‚ùå Upload Error: ${error.message}`, false);
                updateStats(0, false);
            }
        }

        async function testPerformance() {
            const requests = parseInt(document.getElementById('perfRequests').value);
            const concurrency = parseInt(document.getElementById('perfConcurrency').value);
            const url = document.getElementById('perfUrl').value;
            
            displayPerformanceResult(`üöÄ Starting ${requests} requests with ${concurrency} concurrent connections...`);
            
            const results = {
                success: 0,
                errors: 0,
                times: [],
                totalData: 0
            };
            
            const startTime = performance.now();
            
            // Create batches for concurrency control
            const batches = [];
            for (let i = 0; i < requests; i += concurrency) {
                const batchSize = Math.min(concurrency, requests - i);
                const batch = [];
                
                for (let j = 0; j < batchSize; j++) {
                    batch.push(
                        fetch(url)
                            .then(async response => {
                                const requestEndTime = performance.now();
                                const text = await response.text();
                                results.times.push(requestEndTime - startTime);
                                results.totalData += text.length;
                                if (response.ok) {
                                    results.success++;
                                } else {
                                    results.errors++;
                                }
                            })
                            .catch(() => {
                                results.errors++;
                            })
                    );
                }
                
                batches.push(Promise.all(batch));
            }
            
            try {
                await Promise.all(batches);
                
                const endTime = performance.now();
                const totalTime = endTime - startTime;
                
                // Calculate statistics
                const avgTime = results.times.reduce((a, b) => a + b, 0) / results.times.length;
                const minTime = Math.min(...results.times);
                const maxTime = Math.max(...results.times);
                const successRate = (results.success / requests) * 100;
                const requestsPerSecond = (requests / totalTime) * 1000;
                
                let result = `üìä Performance Test Results\n`;
                result += `Total time: ${Math.round(totalTime)}ms\n`;
                result += `Requests: ${requests}\n`;
                result += `Success: ${results.success} (${Math.round(successRate)}%)\n`;
                result += `Errors: ${results.errors}\n`;
                result += `Requests/second: ${Math.round(requestsPerSecond)}\n`;
                result += `Response times:\n`;
                result += `  Average: ${Math.round(avgTime)}ms\n`;
                result += `  Min: ${Math.round(minTime)}ms\n`;
                result += `  Max: ${Math.round(maxTime)}ms\n`;
                result += `Data transferred: ${formatBytes(results.totalData)}`;
                
                displayPerformanceResult(result);
                updateStats(avgTime, results.success > 0, results.totalData);
                
            } catch (error) {
                displayPerformanceResult(`‚ùå Performance test failed: ${error.message}`);
            }
        }

        // Page navigation
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Remove active from all tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Mark tab as active
            const activeTab = document.querySelector(`[href="#${pageId}"]`);
            if (activeTab) {
                activeTab.classList.add('active');
            }
            
            // Update URL hash
            updateHash(pageId);
            
            log(`Navigated to ${pageId} page`);
            
            // Page-specific initialization
            if (pageId === 'cookies') {
                refreshCookies();
            } else if (pageId === 'sessions') {
                // Show loading state
                const statusElement = document.getElementById('session-status-indicator');
                if (statusElement) {
                    statusElement.textContent = 'Loading session status...';
                    statusElement.className = 'status status-info';
                }
                // Check session status
                checkStatus();
            }
        }

        // Handle browser back/forward buttons
        window.addEventListener('hashchange', () => {
            const pageId = getHashPage();
            showPage(pageId);
        });

        // Theme management
        function setTheme(themeName) {
            const body = document.body;
            const html = document.documentElement;
            const cycleBtn = document.getElementById('theme-cycle');
            
            if (themeName === 'light') {
                body.removeAttribute('data-theme');
                html.removeAttribute('data-theme');
            } else {
                body.setAttribute('data-theme', themeName);
                html.setAttribute('data-theme', themeName);
            }
            
            cycleBtn.textContent = themeIcons[themeName] || 'üé®';
            setCookie('theme', themeName);
            
            currentTheme = themeName;
            themeChanges++;
            
            updateStats();
            log(`Theme changed to ${themeName}`, 'success');
        }

        function cycleTheme() {
            const currentIndex = themes.indexOf(currentTheme);
            const nextIndex = (currentIndex + 1) % themes.length;
            setTheme(themes[nextIndex]);
        }

        function randomTheme() {
            const randomIndex = Math.floor(Math.random() * themes.length);
            setTheme(themes[randomIndex]);
        }

        function resetTheme() {
            setTheme('light');
        }

        function autoSwitchThemes() {
            if (autoSwitchInterval) {
                clearInterval(autoSwitchInterval);
                autoSwitchInterval = null;
                log('Auto theme switching stopped', 'info');
            } else {
                let currentIndex = 0;
                autoSwitchInterval = setInterval(() => {
                    setTheme(themes[currentIndex]);
                    currentIndex = (currentIndex + 1) % themes.length;
                }, 2500);
                log('Auto theme switching started', 'info');
            }
        }

        function showCurrentColors() {
            const bodyStyle = getComputedStyle(document.body);
            const rootStyle = getComputedStyle(document.documentElement);
            
            const colors = {
                'Background': bodyStyle.backgroundColor,
                'Text': bodyStyle.color,
                'Accent': rootStyle.getPropertyValue('--accent-color').trim(),
                'Card Background': rootStyle.getPropertyValue('--card-bg').trim(),
                'Border': rootStyle.getPropertyValue('--border-color').trim()
            };
            
            const colorModal = document.createElement('div');
            colorModal.style.cssText = `
                position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                background: var(--card-bg); border: 2px solid var(--border-color);
                padding: 2rem; border-radius: 12px; box-shadow: var(--shadow);
                max-width: 500px; z-index: 10000; color: var(--text-color);
            `;
            
            colorModal.innerHTML = `
                <h3 style="color: var(--accent-color); margin-bottom: 1rem;">üé® ${currentTheme.toUpperCase()} Theme Colors</h3>
                <div style="display: grid; gap: 1rem;">
                    ${Object.entries(colors).map(([name, value]) => `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem; background: var(--bg-color); border-radius: 6px;">
                            <span>${name}:</span>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <div style="width: 30px; height: 30px; background: ${value}; border: 1px solid var(--border-color); border-radius: 50%;"></div>
                                <code style="font-size: 0.8rem;">${value}</code>
                            </div>
                        </div>
                    `).join('')}
                </div>
                <button onclick="this.parentElement.remove()" style="
                    margin-top: 1rem; padding: 0.5rem 1rem; background: var(--accent-color);
                    color: white; border: none; border-radius: 6px; cursor: pointer; width: 100%;
                ">Close</button>
            `;
            
            document.body.appendChild(colorModal);
        }

        // Session management - Clean implementation
        let currentSessionId = null;
        let sessionActive = false;

        function updateSessionStatus(hasSession, sessionInfo = null) {
            const statusElement = document.getElementById('session-status-indicator');
            const infoElement = document.getElementById('session-info');
            const detailsElement = document.getElementById('session-details');

            if (hasSession && sessionInfo) {
                statusElement.textContent = `Active: ${sessionInfo.session_id.substring(0, 8)}...`;
                statusElement.className = 'status status-success';
                
                const created = new Date(sessionInfo.created * 1000);
                const lastAccessed = new Date(sessionInfo.last_accessed * 1000);
                const age = Math.floor(sessionInfo.age_seconds);
                
                detailsElement.innerHTML = `
                    <div style="background: var(--input-bg); color: var(--text-color); padding: 12px 15px; margin: 8px 0; border-radius: 6px; border-left: 3px solid var(--accent-color); border: 1px solid var(--border-color); display: flex; justify-content: space-between; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                        <span><strong>Session ID:</strong> ${sessionInfo.session_id}</span>
                    </div>
                    <div style="background: var(--input-bg); color: var(--text-color); padding: 12px 15px; margin: 8px 0; border-radius: 6px; border-left: 3px solid var(--accent-color); border: 1px solid var(--border-color); display: flex; justify-content: space-between; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                        <span><strong>Created:</strong> ${created.toLocaleString()}</span>
                    </div>
                    <div style="background: var(--input-bg); color: var(--text-color); padding: 12px 15px; margin: 8px 0; border-radius: 6px; border-left: 3px solid var(--accent-color); border: 1px solid var(--border-color); display: flex; justify-content: space-between; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                        <span><strong>Last Accessed:</strong> ${lastAccessed.toLocaleString()}</span>
                    </div>
                    <div style="background: var(--input-bg); color: var(--text-color); padding: 12px 15px; margin: 8px 0; border-radius: 6px; border-left: 3px solid var(--accent-color); border: 1px solid var(--border-color); display: flex; justify-content: space-between; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                        <span><strong>Age:</strong> ${age} seconds</span>
                    </div>
                    <div style="background: var(--input-bg); color: var(--text-color); padding: 12px 15px; margin: 8px 0; border-radius: 6px; border-left: 3px solid var(--accent-color); border: 1px solid var(--border-color); display: flex; justify-content: space-between; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                        <span><strong>Data Items:</strong> ${sessionInfo.data_count}</span>
                    </div>
                `;
                infoElement.style.display = 'block';
                
                sessionActive = true;
                currentSessionId = sessionInfo.session_id;
            } else {
                statusElement.textContent = 'No Session Active';
                statusElement.className = 'status status-info';
                infoElement.style.display = 'none';
                
                sessionActive = false;
                currentSessionId = null;
            }
        }

        function updateOutput(elementId, content, isJson = false) {
            const element = document.getElementById(elementId);
            if (element) {
                if (isJson) {
                    element.textContent = JSON.stringify(content, null, 2);
                } else {
                    element.textContent = content;
                }
            }
        }

        async function makeRequest(action, params = {}) {
            try {
                const formData = new URLSearchParams();
                formData.append('action', action);
                
                Object.entries(params).forEach(([key, value]) => {
                    formData.append(key, value);
                });

                log(`Making session request: ${action}`, 'info');

                const response = await fetch('/tests/simple_session.cgi.py', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    credentials: 'include',
                    body: formData.toString()
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const result = await response.json();
                
                // Check if session was expired and cleared
                if (result.message && result.message.includes('expired')) {
                    log(`Session expired: ${result.message}`, 'warning');
                    updateSessionStatus(false);
                } else {
                    log(`Session response: ${result.message}`, result.success ? 'success' : 'error');
                }
                
                return result;

            } catch (error) {
                log(`Session request failed: ${error.message}`, 'error');
                return { success: false, error: error.message };
            }
        }

        async function checkStatus() {
            const result = await makeRequest('info');
            updateOutput('control-output', result, true);
            
            if (result.success && result.has_session && result.session_info) {
                updateSessionStatus(true, {
                    session_id: result.session_id,
                    created: result.session_info.created,
                    last_accessed: result.session_info.last_accessed,
                    age_seconds: result.session_info.age_seconds,
                    data_count: result.session_info.data_count
                });
            } else {
                updateSessionStatus(false);
            }
        }

        async function createSession() {
            const result = await makeRequest('create');
            updateOutput('control-output', result, true);
            
            if (result.success) {
                await checkStatus(); // Refresh status after creation
            }
        }

        async function destroySession() {
            const result = await makeRequest('destroy');
            updateOutput('control-output', result, true);
            
            updateSessionStatus(false);
        }

        async function setData() {
            const key = document.getElementById('data-key').value.trim();
            const value = document.getElementById('data-value').value.trim();
            
            if (!key || !value) {
                log('Please enter both key and value', 'warning');
                return;
            }
            
            const result = await makeRequest('set', { key, value });
            updateOutput('data-output', result, true);
            
            if (result.success) {
                // Clear form fields
                document.getElementById('data-key').value = '';
                document.getElementById('data-value').value = '';
                
                // Refresh status to show updated data count
                await checkStatus();
            } else if (!result.success && result.message && result.message.includes('No active session')) {
                log('No active session - please create a session first', 'warning');
                updateSessionStatus(false);
            }
        }

        async function getData() {
            const key = document.getElementById('data-key').value.trim();
            
            if (!key) {
                log('Please enter a key to retrieve', 'warning');
                return;
            }
            
            const result = await makeRequest('get', { key });
            updateOutput('data-output', result, true);
            
            if (result.success && result.value !== undefined) {
                // Auto-fill the value field
                document.getElementById('data-value').value = result.value;
            } else if (!result.success && result.message && result.message.includes('No active session')) {
                log('No active session - please create a session first', 'warning');
                updateSessionStatus(false);
            }
        }

        async function getAllData() {
            const result = await makeRequest('get');
            updateOutput('data-output', result, true);
            
            if (!result.success && result.message && result.message.includes('No active session')) {
                log('No active session - please create a session first', 'warning');
                updateSessionStatus(false);
            }
        }

        async function listAllSessions() {
            const result = await makeRequest('list');
            
            const listElement = document.getElementById('session-list');
            
            if (result.success && result.sessions) {
                if (result.sessions.length === 0) {
                    listElement.innerHTML = '<p style="color: #999; text-align: center; padding: 20px;">No active sessions found</p>';
                } else {
                    listElement.innerHTML = result.sessions.map(session => {
                        const created = new Date(session.created * 1000);
                        const lastAccessed = new Date(session.last_accessed * 1000);
                        
                        return `
                            <div style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 5px; padding: 10px; margin-bottom: 8px;">
                                <div style="font-weight: bold; color: #495057; margin-bottom: 5px;">
                                    Session: ${session.id}
                                </div>
                                <div style="font-size: 12px; color: #6c757d;">
                                    Created: ${created.toLocaleString()}<br>
                                    Last Accessed: ${lastAccessed.toLocaleString()}<br>
                                    Data Keys: ${session.data_keys.length > 0 ? session.data_keys.join(', ') : 'None'}
                                </div>
                            </div>
                        `;
                    }).join('');
                }
            } else {
                listElement.innerHTML = `<p style="color: #ff4444;">Error: ${result.message || 'Failed to load sessions'}</p>`;
            }
        }

        // CGI testing - Updated interface
        const cgiDescriptions = {
            '/tests/simple.cgi.py': 'Basic Python CGI that displays environment variables and handles GET/POST requests. Shows server info, request details, and can process form data.',
            '/tests/hello.cgi.sh': 'Shell script CGI that demonstrates server-side bash execution. Displays system information, current time, and environment variables.',
            '/tests/json_info.cgi.py': 'Python CGI that returns JSON-formatted response. Useful for API testing and demonstrates structured data output.',
            '/tests/form_processor.cgi.py': 'Interactive form processor that displays an HTML form and processes submitted data. Great for testing POST requests and form handling.',
            '/tests/image_gen.cgi.py': 'Visual content generator that creates ASCII art and styled HTML output. Demonstrates server-side content generation.',
            '/tests/cgi_env.py': 'Comprehensive environment display showing all CGI environment variables. Useful for debugging and understanding server configuration.',
            '/tests/session_manager.cgi.py': 'Advanced CGI for session management and cookie handling. Demonstrates state management in web applications.',
            '/tests/debug_cgi.py': 'Debugging-focused CGI that provides detailed request analysis and server information for troubleshooting.',
            '/tests/perl_demo.cgi.pl': 'Classic Perl CGI script using CGI.pm module. Demonstrates traditional Perl web programming with rich formatting and system information display.',
            '/tests/ruby_gem.cgi.rb': 'Elegant Ruby CGI script showcasing Ruby\'s syntax and capabilities. Features modern styling and comprehensive runtime information.',
            '/tests/php_magic.cgi': 'Dynamic PHP CGI with animated gradients and comprehensive server information. Shows PHP superglobals and environment details.',
            '/tests/c_power.cgi': 'High-performance compiled C binary CGI script. Demonstrates maximum execution speed with direct system calls and minimal memory footprint.',
            '/tests/node_rocket.cgi.js': 'Modern Node.js CGI using V8 engine. Shows JavaScript server-side capabilities with system information and memory usage statistics.',
            '/tests/awk_power.cgi.awk': 'AWK pattern-action programming CGI. Demonstrates text processing capabilities and pattern matching in a web context.'
        };

        // Initialize CGI interface
        function initializeCGI() {
            const selector = document.getElementById('cgi-selector');
            const methodSelector = document.getElementById('cgi-method');
            const postDataSection = document.getElementById('post-data-section');
            const descriptionDiv = document.getElementById('cgi-description');
            
            // Update description when script selection changes
            selector.addEventListener('change', function() {
                const selectedScript = selector.value;
                descriptionDiv.textContent = cgiDescriptions[selectedScript] || 'No description available.';
            });
            
            // Show/hide POST data section based on method
            methodSelector.addEventListener('change', function() {
                postDataSection.style.display = methodSelector.value === 'POST' ? 'block' : 'none';
            });
            
            // Set initial description
            const initialScript = selector.value;
            descriptionDiv.textContent = cgiDescriptions[initialScript] || 'No description available.';
        }

        async function executeCGI() {
            const selector = document.getElementById('cgi-selector');
            const methodSelector = document.getElementById('cgi-method');
            const queryInput = document.getElementById('cgi-query');
            const postDataInput = document.getElementById('cgi-post-data');
            const statusSpan = document.getElementById('cgi-status');
            const iframe = document.getElementById('cgi-iframe');
            
            const scriptPath = selector.value;
            const method = methodSelector.value;
            const queryParams = queryInput.value;
            const postData = postDataInput.value;
            
            try {
                statusSpan.textContent = `Executing ${method} request...`;
                statusSpan.className = 'status status-info';
                
                // Build URL with query parameters
                let url = scriptPath;
                if (queryParams) {
                    url += (url.includes('?') ? '&' : '?') + queryParams;
                }
                
                // Prepare fetch options
                const fetchOptions = {
                    method: method,
                };
                
                if (method === 'POST' && postData) {
                    fetchOptions.headers = {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    };
                    fetchOptions.body = postData;
                }
                
                const response = await fetch(url, fetchOptions);
                const responseText = await response.text();
                
                // Display response in iframe
                iframe.srcdoc = responseText;
                
                statusSpan.textContent = `Success: ${response.status} ${response.statusText}`;
                statusSpan.className = response.ok ? 'status status-success' : 'status status-warning';
                
                log(`CGI executed: ${method} ${scriptPath} - Status: ${response.status}`, response.ok ? 'success' : 'warning');
                
            } catch (error) {
                iframe.srcdoc = `<html><body><h2>Error</h2><p>${error.message}</p></body></html>`;
                statusSpan.textContent = `Error: ${error.message}`;
                statusSpan.className = 'status status-error';
                log(`CGI execution failed: ${error.message}`, 'error');
            }
        }

        function clearCGIOutput() {
            document.getElementById('cgi-iframe').srcdoc = '<html><body><h2>Output Cleared</h2><p>Ready for next execution.</p></body></html>';
            log('CGI output cleared', 'info');
        }

        function openCGIInNewTab() {
            const selector = document.getElementById('cgi-selector');
            const queryInput = document.getElementById('cgi-query');
            
            let url = selector.value;
            if (queryInput.value) {
                url += (url.includes('?') ? '&' : '?') + queryInput.value;
            }
            
            window.open(url, '_blank');
            log(`Opened CGI in new tab: ${url}`, 'info');
        }

        function downloadCGIResponse() {
            const iframe = document.getElementById('cgi-iframe');
            const content = iframe.srcdoc || iframe.contentDocument?.documentElement.outerHTML || 'No content available';
            
            const blob = new Blob([content], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'cgi-response.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            log('CGI response downloaded', 'success');
        }

        async function testFormSubmission() {
            document.getElementById('cgi-selector').value = '/tests/form_processor.cgi.py';
            document.getElementById('cgi-method').value = 'GET';
            document.getElementById('cgi-query').value = '';
            await executeCGI();
            log('Form submission test prepared', 'info');
        }

        async function testErrorHandling() {
            try {
                document.getElementById('cgi-status').textContent = 'Testing 404 error...';
                document.getElementById('cgi-status').className = 'status status-info';
                
                const response = await fetch('/tests/nonexistent_script.cgi.py');
                const html = await response.text();
                
                const iframe = document.getElementById('cgi-iframe');
                iframe.srcdoc = html;
                
                document.getElementById('cgi-status').textContent = `Error test: ${response.status} ${response.statusText}`;
                document.getElementById('cgi-status').className = 'status status-success';
                
                log(`404 error test completed: ${response.status}`, 'success');
            } catch (error) {
                document.getElementById('cgi-status').textContent = `Network error: ${error.message}`;
                document.getElementById('cgi-status').className = 'status status-success';
                log(`404 error test completed with network error: ${error.message}`, 'success');
            }
        }

        async function testTimeout() {
            // This would test a CGI script that takes a long time to execute
            document.getElementById('cgi-selector').value = '/tests/cgi_env.py';
            document.getElementById('cgi-method').value = 'GET';
            document.getElementById('cgi-query').value = 'slow=1&delay=5';
            await executeCGI();
            log('Timeout test initiated', 'warning');
        }

        // Cookie management
        function refreshCookies() {
            const cookies = getAllCookies();
            const count = Object.keys(cookies).length;
            
            document.getElementById('cookie-count').textContent = `${count} cookies`;
            document.getElementById('cookie-count').className = count > 0 ? 'status status-success' : 'status status-info';
            
            const display = document.getElementById('cookie-display');
            if (count > 0) {
                display.innerHTML = Object.entries(cookies).map(([name, value]) => 
                    `<div class="log-entry"><strong>${name}:</strong> ${value}</div>`
                ).join('');
            } else {
                display.innerHTML = '<div class="log-entry log-info">No cookies found</div>';
            }
            
            log(`Refreshed cookies: ${count} found`, 'info');
        }

        function setCustomCookie() {
            const name = document.getElementById('cookie-name').value;
            const value = document.getElementById('cookie-value').value;
            
            if (!name || !value) {
                log('Please enter both cookie name and value', 'warning');
                return;
            }
            
            setCookie(name, value);
            refreshCookies();
            log(`Set cookie: ${name}=${value}`, 'success');
            
            // Clear inputs
            document.getElementById('cookie-name').value = '';
            document.getElementById('cookie-value').value = '';
        }

        function createTestCookies() {
            setCookie('test_cookie_1', 'test_value_1');
            setCookie('test_cookie_2', 'test_value_2');
            setCookie('timestamp', Date.now().toString());
            refreshCookies();
            log('Created test cookies', 'success');
        }

        function clearAllCookies() {
            const cookies = getAllCookies();
            Object.keys(cookies).forEach(name => {
                document.cookie = `${name}=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/`;
            });
            refreshCookies();
            log('Cleared all cookies', 'success');
        }

        // Debug functions
        function showSystemInfo() {
            const info = {
                'User Agent': navigator.userAgent,
                'Platform': navigator.platform,
                'Language': navigator.language,
                'Screen Resolution': `${screen.width}x${screen.height}`,
                'Viewport Size': `${window.innerWidth}x${window.innerHeight}`,
                'Cookies Enabled': navigator.cookieEnabled,
                'Current URL': window.location.href,
                'Current Theme': currentTheme,
                'Theme Changes': themeChanges,
                'Session Time': Math.floor((Date.now() - sessionStartTime) / 1000) + 's'
            };
            
            const output = document.getElementById('debug-output');
            output.innerHTML = Object.entries(info).map(([key, value]) => 
                `<div class="log-entry"><strong>${key}:</strong> ${value}</div>`
            ).join('');
            
            log('System information displayed', 'info');
        }

        function testNetwork() {
            const output = document.getElementById('debug-output');
            output.innerHTML = '<div class="log-entry log-info">Testing network connectivity...</div>';
            
            fetch('/tests/simple.cgi.py?network_test=true')
                .then(response => {
                    output.innerHTML += `<div class="log-entry log-success">Network test successful: ${response.status}</div>`;
                    log('Network test passed', 'success');
                })
                .catch(error => {
                    output.innerHTML += `<div class="log-entry log-error">Network test failed: ${error.message}</div>`;
                    log(`Network test failed: ${error.message}`, 'error');
                });
        }

        function exportLogs() {
            const logs = activityLog.map(entry => entry.message).join('\n');
            const blob = new Blob([logs], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `webserv-logs-${Date.now()}.txt`;
            a.click();
            
            URL.revokeObjectURL(url);
            log('Logs exported', 'success');
        }

        function resetAll() {
            clearAllCookies();
            setTheme('light');
            themeChanges = 0;
            sessionStartTime = Date.now();
            
            if (autoSwitchInterval) {
                clearInterval(autoSwitchInterval);
                autoSwitchInterval = null;
            }
            
            updateStats();
            log('Everything reset to defaults', 'success');
        }

        function clearLogs() {
            activityLog = [];
            document.getElementById('activity-log').innerHTML = '<div class="log-entry log-info">[Init] Logs cleared</div>';
            log('Activity logs cleared', 'info');
        }

        // Stats update
        function updateStats() {
            document.getElementById('theme-changes').textContent = themeChanges;
            document.getElementById('current-theme').textContent = currentTheme.charAt(0).toUpperCase() + currentTheme.slice(1);
            document.getElementById('session-time').textContent = Math.floor((Date.now() - sessionStartTime) / 1000) + 's';
        }

        // Update session time every second
        setInterval(updateStats, 1000);

        // Initialize
        function initializeSPA() {
            // FIRST: Load and apply saved theme BEFORE any navigation
            const savedTheme = getCookie('theme') || 'light';
            if (themes.includes(savedTheme)) {
                setTheme(savedTheme);
            }
            
            // THEN: Handle initial page from URL hash
            const initialPage = getHashPage();
            showPage(initialPage);
            
            // Load saved stats
            const savedChanges = getCookie('theme_changes');
            if (savedChanges) {
                themeChanges = parseInt(savedChanges);
            }
            
            // Initialize POST content with current timestamp
            const postContent = document.getElementById('postContent');
            if (postContent) {
                postContent.value = `Test POST with timestamp: ${new Date().toISOString()}`;
            }
            
            // Initialize CGI interface
            initializeCGI();
            
            // Add resize toggle buttons to response areas
            setTimeout(() => {
                // Add toggle buttons to various response areas
                const responseAreas = [
                    { container: 'webTestResult', target: 'webTestResult' },
                    { container: 'performanceResult', target: 'performanceResult' },
                    { container: 'session-data', target: 'session-data' },
                    { container: 'all-sessions-data', target: 'all-sessions-data' },
                    { container: 'cookie-display', target: 'cookie-display' },
                    { container: 'debug-output', target: 'debug-output' },
                    { container: 'activity-log', target: 'activity-log' }
                ];
                
                responseAreas.forEach(area => {
                    const element = document.getElementById(area.target);
                    if (element && element.className.includes('log-area')) {
                        // Add a toggle button to the parent container
                        const parent = element.closest('.response-display') || element.closest('.card');
                        if (parent) {
                            const header = parent.querySelector('h4');
                            if (header && !header.querySelector('.resize-toggle')) {
                                const button = document.createElement('button');
                                button.className = 'btn resize-toggle';
                                button.style.marginLeft = '0.5rem';
                                button.style.fontSize = '0.8rem';
                                button.style.padding = '0.3rem 0.6rem';
                                button.textContent = 'üìê Auto Size';
                                button.onclick = () => toggleResponseBoxSize(area.target);
                                header.appendChild(button);
                            }
                        }
                    }
                });
            }, 100);
            
            // Initial updates
            updateStats();
            refreshCookies();
            
            log('üöÄ Single Page Application initialized', 'success');
        }

        // Save stats periodically
        setInterval(() => {
            setCookie('theme_changes', themeChanges);
        }, 5000);

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializeSPA);
    </script>
</body>
</html>
